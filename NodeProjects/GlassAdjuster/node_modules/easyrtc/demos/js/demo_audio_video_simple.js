var selfEasyrtcid = "";
var recepientEasyrtcid = "";
var name="";

function connect() {
	name = prompt('Enter name:');
	easyrtc.setUsername(name);
    easyrtc.setRoomOccupantListener(convertListToButtons);
    easyrtc.easyApp("easyrtc.audioVideo", "selfVideo", ["callerVideo"], loginSuccess, loginFailure);
 }


function clearConnectList() {
    var otherClientDiv = document.getElementById('otherClients');
    while (otherClientDiv.hasChildNodes()) {
        otherClientDiv.removeChild(otherClientDiv.lastChild);
    }
}


function convertListToButtons (roomName, data, isPrimary) {
    clearConnectList();
    var listCreated = false;
 if(!listCreated){
    $("#otherClients").append('<ul id="list" data-role="listview" data-filter="true" data-inset="true" data-split-icon="myapp-settings" data-split-theme="d"></ul>');
    listCreated = true;
    $("#otherClients").trigger("create");
var listItem = '<li data-role="list-divider" data-theme="a">Connected Users</li>';
$("#list").append(listItem);
}
    
    
      for(var easyrtcid in data) {
      console.log("listCreated"+listCreated );
 
var value = easyrtc.idToName(easyrtcid);
var listItem = '<li><a>' + value + '</a><a href="#purchase" data-rel="popup" data-position-to="window" data-transition="pop">Enable Chat</a></li>';
$("#list").append(listItem);
    $("#list").listview('refresh');
    /*
        var button = document.createElement('button');
        button.onclick = function(easyrtcid) {
            return function() {
                performCall(easyrtcid);
            };
        }(easyrtcid);


        var label = document.createTextNode("Connect to "+easyrtc.idToName(easyrtcid));
        button.appendChild(label);
         li.concat(button);
        $("ul").append(li.concat(easyrtc.idToName(easyrtcid)));
        
        */
         
         
   }
}


function performCall(otherEasyrtcid) {
    easyrtc.hangupAll();

    var successCB = function() {};
    var failureCB = function() {};
    easyrtc.call(otherEasyrtcid, successCB, failureCB);
}


function loginSuccess(easyrtcid) {
    selfEasyrtcid = easyrtcid;
    document.getElementById("iam").innerHTML =  name+" you can chat now" ;
}
function EnableChat() {
    console.log("button tapped");
    document.getElementById("videos").style.visibility = "visible";
}

function loginFailure(errorCode, message) {
    easyrtc.showError(errorCode, message);
}